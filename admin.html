<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dream Makers Admin Portal</title>
    <link rel="icon" type="image/png" href="https://dilnuka13.github.io/Dream_Makers/logo.png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { 
            darkMode: 'class', 
            theme: { 
                extend: { 
                    colors: { 
                        dark: { bg: '#0f172a', card: '#1e293b', text: '#f1f5f9', border: '#334155' },
                        primary: '#1e3a8a'
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                } 
            } 
        }
    </script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Supabase JS -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Poppins', sans-serif; }
        .sidebar-transition { transition: all 0.3s ease-in-out; }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }
        
        .custom-table th { font-weight: 600; text-transform: uppercase; font-size: 0.75rem; letter-spacing: 0.05em; }
        .custom-table td { border-bottom-width: 1px; }
        
        #loading-overlay { display: none; }
        #loading-overlay.active { display: flex; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 dark:bg-slate-950 dark:text-slate-200 h-screen overflow-hidden flex transition-colors duration-300">

    <!-- LOADING OVERLAY -->
    <div id="loading-overlay" class="fixed inset-0 z-[100] bg-white/90 dark:bg-slate-900/90 backdrop-blur-md items-center justify-center flex-col text-center">
        <div class="relative">
            <div class="w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4 mx-auto"></div>
        </div>
        <h2 class="text-xl font-bold text-blue-900 dark:text-white uppercase tracking-widest animate-pulse">Processing...</h2>
        <p id="loading-text" class="text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-widest mt-1">Please wait</p>
    </div>

    <!-- LOGIN SCREEN -->
    <div id="login-screen" class="fixed inset-0 z-50 bg-slate-900 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-slate-800 rounded-3xl p-8 w-full max-w-md shadow-2xl relative overflow-hidden animate-fade-in">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-600 to-purple-600"></div>
            <div class="text-center mb-8 mt-4">
                <h2 class="text-3xl font-extrabold text-slate-800 dark:text-white mb-1">Welcome Back!</h2>
                <p class="text-sm text-slate-500 dark:text-slate-400">Please sign in to continue</p>
            </div>
            
            <form id="login-form" class="space-y-5">
                <div>
                    <label class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase mb-1">Email Address</label>
                    <input type="email" id="login-email" class="w-full p-3 rounded-xl border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white focus:border-blue-500 outline-none transition" placeholder="Enter your email">
                </div>
                <div>
                    <div class="flex justify-between items-center mb-1">
                        <label class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase">Password</label>
                        <a href="#" onclick="forgotPassword()" class="text-xs text-blue-600 hover:underline">Forgot Password?</a>
                    </div>
                    <input type="password" id="login-password" class="w-full p-3 rounded-xl border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white focus:border-blue-500 outline-none transition" placeholder="••••••••">
                </div>
                <button type="submit" class="w-full bg-gradient-to-r from-blue-900 to-blue-700 text-white py-3 rounded-xl font-bold hover:shadow-lg hover:scale-[1.02] transition-all duration-200">Sign In</button>
            </form>

            <div class="flex items-center gap-4 my-6">
                <div class="h-px bg-slate-200 dark:bg-slate-700 flex-1"></div>
                <span class="text-xs text-slate-400 font-bold uppercase">Or</span>
                <div class="h-px bg-slate-200 dark:bg-slate-700 flex-1"></div>
            </div>

            <button id="google-login-btn" class="w-full bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 text-slate-700 dark:text-white py-3 rounded-xl font-bold hover:bg-slate-50 dark:hover:bg-slate-600 transition flex items-center justify-center gap-3">
                <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5 h-5">
                <span>Super Admin Login (Google)</span>
            </button>

            <p id="login-error" class="text-red-500 text-xs text-center mt-4 hidden bg-red-50 dark:bg-red-900/20 p-2 rounded-lg"></p>
        </div>
    </div>

    <!-- MAIN APP (Hidden until login) -->
    <div id="app-container" class="flex w-full h-full hidden">
        
        <!-- SIDEBAR -->
        <aside class="w-64 bg-slate-900 dark:bg-slate-950 text-slate-300 flex flex-col shadow-xl z-20 sidebar-transition flex-shrink-0">
            <div class="p-6 border-b border-slate-800 flex items-center gap-3">
                <div class="w-10 h-10 rounded-lg bg-blue-600 flex items-center justify-center text-white font-bold text-lg shadow-lg">DM</div>
                <div>
                    <span class="block font-bold text-white tracking-wide">Admin Portal</span>
                    <span class="text-[10px] text-slate-500 uppercase tracking-wider">Dream Makers</span>
                </div>
            </div>
            
            <nav class="flex-1 overflow-y-auto py-4 space-y-1 px-3 custom-scrollbar">
                <button onclick="switchTab('dashboard')" class="nav-btn active w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium hover:bg-slate-800 transition text-left">
                    <i class="fas fa-chart-pie w-5 text-center"></i> Dashboard
                </button>
                
                <!-- Super Admin Only Section -->
                <div id="super-admin-menu" class="hidden">
                    <p class="px-4 mt-6 mb-2 text-[10px] font-bold uppercase text-yellow-500 tracking-wider">Super Access</p>
                    <button onclick="switchTab('admins')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium hover:bg-slate-800 transition text-left text-yellow-100">
                        <i class="fas fa-user-shield w-5 text-center"></i> Manage Admins
                    </button>
                </div>

                <p class="px-4 mt-6 mb-2 text-[10px] font-bold uppercase text-slate-500 tracking-wider">Content</p>
                <button onclick="switchTab('members')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium hover:bg-slate-800 transition text-left">
                    <i class="fas fa-users w-5 text-center"></i> Members
                </button>
                <button onclick="switchTab('messages')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium hover:bg-slate-800 transition text-left">
                    <i class="fas fa-envelope w-5 text-center"></i> Messages
                </button>
                <button onclick="switchTab('events')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium hover:bg-slate-800 transition text-left">
                    <i class="fas fa-calendar-alt w-5 text-center"></i> Events
                </button>
                <button onclick="switchTab('gallery')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium hover:bg-slate-800 transition text-left">
                    <i class="fas fa-images w-5 text-center"></i> Gallery
                </button>
                <button onclick="switchTab('slideshow')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium hover:bg-slate-800 transition text-left">
                    <i class="fas fa-photo-video w-5 text-center"></i> Hero Slideshow
                </button>
                <button onclick="switchTab('downloads')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium hover:bg-slate-800 transition text-left">
                    <i class="fas fa-download w-5 text-center"></i> Downloads
                </button>
                <button onclick="switchTab('quicklinks')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium hover:bg-slate-800 transition text-left">
                    <i class="fas fa-link w-5 text-center"></i> Quick Links
                </button>
                
                <p class="px-4 mt-6 mb-2 text-[10px] font-bold uppercase text-slate-500 tracking-wider">Organization</p>
                <button onclick="switchTab('officers')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium hover:bg-slate-800 transition text-left">
                    <i class="fas fa-user-tie w-5 text-center"></i> Officers
                </button>
                <button onclick="switchTab('sports')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium hover:bg-slate-800 transition text-left">
                    <i class="fas fa-running w-5 text-center"></i> Sports Teams
                </button>
                
                <p class="px-4 mt-6 mb-2 text-[10px] font-bold uppercase text-slate-500 tracking-wider">System</p>
                <button onclick="switchTab('settings')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium hover:bg-slate-800 transition text-left">
                    <i class="fas fa-cog w-5 text-center"></i> Settings
                </button>
            </nav>

            <div class="p-4 border-t border-slate-800 space-y-2">
                <button onclick="toggleTheme()" class="w-full flex items-center justify-between px-4 py-3 rounded-xl text-sm font-medium bg-slate-800 hover:bg-slate-700 transition">
                    <span class="flex items-center gap-2"><i class="fas fa-moon"></i> Theme</span>
                    <span id="theme-status" class="text-xs bg-slate-900 px-2 py-0.5 rounded text-slate-400">Dark</span>
                </button>
                <button onclick="logout()" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium text-red-400 hover:bg-slate-800 transition">
                    <i class="fas fa-sign-out-alt w-5 text-center"></i> Logout
                </button>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="flex-1 bg-slate-50 dark:bg-slate-900 overflow-y-auto relative h-full transition-colors duration-300">
            <!-- Header -->
            <header class="bg-white dark:bg-slate-800 sticky top-0 z-10 px-8 py-4 flex items-center justify-between shadow-sm border-b border-slate-200 dark:border-slate-700">
                <div class="flex items-center gap-4">
                    <img src="https://dilnuka13.github.io/Dream_Makers/logo.png" class="w-10 h-10 object-contain">
                    <h1 id="page-title" class="text-xl font-bold text-slate-800 dark:text-white">Dashboard</h1>
                </div>
                
                <div class="flex items-center gap-4">
                    <div class="text-right">
                        <span id="admin-name" class="block text-sm font-bold text-slate-800 dark:text-white">Admin</span>
                        <span id="admin-role" class="block text-xs text-slate-500 dark:text-slate-400 uppercase">Role</span>
                    </div>
                    <div class="w-10 h-10 rounded-full border-2 border-slate-200 dark:border-slate-600 shadow-sm overflow-hidden bg-slate-100">
                        <img id="user-avatar" src="https://ui-avatars.com/api/?name=Admin&background=0D8ABC&color=fff" class="w-full h-full object-cover">
                    </div>
                </div>
            </header>

            <div class="p-8 max-w-7xl mx-auto space-y-8 pb-20">
                
                <!-- 1. DASHBOARD TAB -->
                <div id="tab-dashboard" class="tab-content block space-y-8 animate-fade-in">
                    <div class="flex justify-end">
                        <button onclick="initDashboard()" class="text-blue-600 hover:text-blue-800 text-sm font-bold bg-blue-50 dark:bg-slate-800 px-4 py-2 rounded-lg transition"><i class="fas fa-sync-alt mr-2"></i> Refresh</button>
                    </div>
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 hover:shadow-md transition">
                            <div class="flex justify-between items-start mb-4">
                                <div><p class="text-xs font-bold text-slate-400 uppercase">Total Members</p><h3 class="text-2xl font-bold text-slate-800 dark:text-white" id="dash-total-members">0</h3></div>
                                <div class="w-10 h-10 rounded-lg bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 flex items-center justify-center"><i class="fas fa-users"></i></div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 hover:shadow-md transition">
                            <div class="flex justify-between items-start mb-4">
                                <div><p class="text-xs font-bold text-slate-400 uppercase">Pending Req.</p><h3 class="text-2xl font-bold text-orange-600 dark:text-orange-400" id="dash-pending-members">0</h3></div>
                                <div class="w-10 h-10 rounded-lg bg-orange-50 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 flex items-center justify-center"><i class="fas fa-user-clock"></i></div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 hover:shadow-md transition">
                            <div class="flex justify-between items-start mb-4">
                                <div><p class="text-xs font-bold text-slate-400 uppercase">Events</p><h3 class="text-2xl font-bold text-slate-800 dark:text-white" id="dash-total-events">0</h3></div>
                                <div class="w-10 h-10 rounded-lg bg-purple-50 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 flex items-center justify-center"><i class="fas fa-calendar-check"></i></div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 hover:shadow-md transition">
                            <div class="flex justify-between items-start mb-4">
                                <div><p class="text-xs font-bold text-slate-400 uppercase">Messages</p><h3 class="text-2xl font-bold text-slate-800 dark:text-white" id="dash-total-msgs">0</h3></div>
                                <div class="w-10 h-10 rounded-lg bg-green-50 dark:bg-green-900/30 text-green-600 dark:text-green-400 flex items-center justify-center"><i class="fas fa-envelope"></i></div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700">
                            <h3 class="font-bold text-slate-700 dark:text-slate-200 mb-4">Member Growth</h3>
                            <canvas id="memberChart"></canvas>
                        </div>
                         <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700">
                            <h3 class="font-bold text-slate-700 dark:text-slate-200 mb-4">Activity Overview</h3>
                            <canvas id="activityChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- 2. ADMINS TAB -->
                <div id="tab-admins" class="tab-content hidden space-y-6 animate-fade-in">
                    <div class="flex justify-between items-center bg-white dark:bg-slate-800 p-4 rounded-xl border dark:border-slate-700">
                        <div>
                            <h3 class="font-bold text-lg text-slate-800 dark:text-white">Admin Management</h3>
                            <p class="text-sm text-slate-500 dark:text-slate-400">Manage Sub-Admins</p>
                        </div>
                        <div class="flex gap-2">
                            <div class="relative">
                                <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                                <input type="text" onkeyup="filterAdmins(this.value)" placeholder="Search Admins..." class="pl-9 pr-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white text-sm focus:ring-2 focus:ring-blue-500 outline-none w-64">
                            </div>
                            <button onclick="loadAdmins()" class="bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 px-3 py-2 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-600 transition"><i class="fas fa-sync-alt"></i></button>
                            <button onclick="openModal('admin-modal')" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-blue-700 shadow-lg"><i class="fas fa-user-plus mr-2"></i> Create</button>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left text-sm custom-table text-slate-600 dark:text-slate-300">
                                <thead class="bg-slate-50 dark:bg-slate-700/50"><tr><th class="px-6 py-4">Name</th><th class="px-6 py-4">Email</th><th class="px-6 py-4">Role</th><th class="px-6 py-4">Last Login</th><th class="px-6 py-4">Status</th><th class="px-6 py-4 text-right">Actions</th></tr></thead>
                                <tbody id="admins-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 3. MEMBERS TAB -->
                <div id="tab-members" class="tab-content hidden space-y-6 animate-fade-in">
                    <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden">
                        <div class="p-6 border-b border-slate-100 dark:border-slate-700 flex flex-col lg:flex-row justify-between gap-4 items-center">
                            <div class="flex items-center gap-2 w-full lg:w-auto">
                                <h3 class="font-bold text-lg text-slate-800 dark:text-white">Member Management</h3>
                                <button onclick="loadMembers()" class="text-slate-400 hover:text-blue-600 ml-2"><i class="fas fa-sync-alt"></i></button>
                            </div>
                            <div class="flex gap-2 flex-wrap w-full lg:w-auto justify-end">
                                <div class="relative w-full sm:w-auto">
                                    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                                    <input type="text" onkeyup="filterMembers(this.value)" placeholder="Search Name/NIC/Phone..." class="w-full sm:w-64 pl-9 pr-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white text-sm focus:ring-2 focus:ring-blue-500 outline-none">
                                </div>
                                <select onchange="filterMembersByStatus(this.value)" class="py-2 px-3 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white text-sm outline-none">
                                    <option value="all">All Status</option>
                                    <option value="active">Active</option>
                                    <option value="pending">Pending</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                                <button onclick="openModal('member-modal')" class="px-4 py-2 text-xs font-bold bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow"><i class="fas fa-plus mr-1"></i> Add</button>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left text-sm custom-table text-slate-600 dark:text-slate-300">
                                <thead class="bg-slate-50 dark:bg-slate-700/50"><tr><th class="px-6 py-4">Name</th><th class="px-6 py-4">Contact</th><th class="px-6 py-4">Status</th><th class="px-6 py-4 text-right">Actions</th></tr></thead>
                                <tbody id="members-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 3.5 MESSAGES TAB -->
                <div id="tab-messages" class="tab-content hidden space-y-6 animate-fade-in">
                    <div class="flex justify-between items-center bg-white dark:bg-slate-800 p-4 rounded-xl border dark:border-slate-700">
                        <h3 class="font-bold text-lg text-slate-800 dark:text-white">Inbox</h3>
                        <div class="flex gap-2">
                            <div class="relative">
                                <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                                <input type="text" onkeyup="filterMessages(this.value)" placeholder="Search Messages..." class="pl-9 pr-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white text-sm focus:ring-2 focus:ring-blue-500 outline-none w-64">
                            </div>
                            <button onclick="loadMessages()" class="bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 px-3 py-2 rounded-lg hover:bg-slate-200 transition"><i class="fas fa-sync-alt"></i></button>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden">
                        <table class="w-full text-left text-sm custom-table text-slate-600 dark:text-slate-300">
                            <thead class="bg-slate-50 dark:bg-slate-700/50"><tr><th class="px-6 py-4">From</th><th class="px-6 py-4">Message</th><th class="px-6 py-4">Date</th><th class="px-6 py-4 text-right">Actions</th></tr></thead>
                            <tbody id="messages-list"></tbody>
                        </table>
                    </div>
                </div>

                <!-- 4. EVENTS TAB -->
                <div id="tab-events" class="tab-content hidden space-y-6 animate-fade-in">
                    <div class="flex justify-between items-center bg-white dark:bg-slate-800 p-4 rounded-xl border dark:border-slate-700">
                        <h3 class="font-bold text-lg text-slate-800 dark:text-white">Events</h3>
                        <div class="flex gap-2">
                            <div class="relative">
                                <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                                <input type="text" onkeyup="filterEvents(this.value)" placeholder="Search Events..." class="pl-9 pr-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white text-sm focus:ring-2 focus:ring-blue-500 outline-none w-64">
                            </div>
                            <button onclick="loadEvents()" class="bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 px-3 py-2 rounded-lg hover:bg-slate-200 transition"><i class="fas fa-sync-alt"></i></button>
                            <button onclick="openModal('event-modal')" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-blue-700 shadow-lg"><i class="fas fa-plus mr-2"></i> Add</button>
                        </div>
                    </div>
                    <div id="events-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                </div>

                <!-- 5. GALLERY TAB -->
                <div id="tab-gallery" class="tab-content hidden space-y-6 animate-fade-in">
                    <div class="flex justify-between items-center bg-white dark:bg-slate-800 p-4 rounded-xl border dark:border-slate-700">
                        <h3 class="font-bold text-lg text-slate-800 dark:text-white">Gallery Albums</h3>
                        <div class="flex gap-2">
                            <div class="relative">
                                <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                                <input type="text" onkeyup="filterAlbums(this.value)" placeholder="Search Albums..." class="pl-9 pr-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white text-sm focus:ring-2 focus:ring-blue-500 outline-none w-64">
                            </div>
                            <button onclick="loadAlbums()" class="bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 px-3 py-2 rounded-lg hover:bg-slate-200 transition"><i class="fas fa-sync-alt"></i></button>
                            <button onclick="openModal('album-modal')" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-blue-700 shadow-lg"><i class="fas fa-plus mr-2"></i> New Album</button>
                        </div>
                    </div>
                    <div id="albums-list" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
                    
                    <div id="album-manager" class="hidden bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-100 dark:border-slate-700 mt-6">
                        <div class="flex justify-between items-center mb-6">
                            <button onclick="closeAlbumManager()" class="text-slate-500 dark:text-slate-400 hover:text-blue-600 text-sm font-bold"><i class="fas fa-arrow-left mr-2"></i> Back</button>
                            <h4 id="manage-album-title" class="font-bold text-lg text-slate-800 dark:text-white">Manage Images</h4>
                            <button onclick="openModal('image-modal')" class="bg-green-600 text-white px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-green-700"><i class="fas fa-cloud-upload-alt mr-1"></i> Add Images</button>
                        </div>
                        <div id="album-images-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
                    </div>
                </div>

                <!-- 6. SLIDESHOW TAB -->
                <div id="tab-slideshow" class="tab-content hidden space-y-6 animate-fade-in">
                    <div class="flex justify-between items-center bg-white dark:bg-slate-800 p-4 rounded-xl border dark:border-slate-700">
                        <h3 class="font-bold text-lg text-slate-800 dark:text-white">Home Slideshow</h3>
                        <div class="flex gap-2">
                            <button onclick="loadSlides()" class="bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 px-3 py-2 rounded-lg hover:bg-slate-200 transition"><i class="fas fa-sync-alt"></i></button>
                            <button onclick="openModal('slide-modal')" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-blue-700"><i class="fas fa-plus mr-2"></i> Add Slide</button>
                        </div>
                    </div>
                    <div id="slides-list" class="space-y-4"></div>
                </div>

                <!-- 7. DOWNLOADS TAB -->
                <div id="tab-downloads" class="tab-content hidden space-y-6 animate-fade-in">
                    <div class="flex justify-between items-center bg-white dark:bg-slate-800 p-4 rounded-xl border dark:border-slate-700">
                        <h3 class="font-bold text-lg text-slate-800 dark:text-white">Downloads</h3>
                        <div class="flex gap-2">
                            <div class="relative">
                                <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                                <input type="text" onkeyup="filterDownloads(this.value)" placeholder="Search Files..." class="pl-9 pr-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white text-sm focus:ring-2 focus:ring-blue-500 outline-none w-64">
                            </div>
                            <button onclick="loadDownloads()" class="bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 px-3 py-2 rounded-lg hover:bg-slate-200 transition"><i class="fas fa-sync-alt"></i></button>
                            <button onclick="openModal('download-modal')" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-blue-700"><i class="fas fa-plus mr-2"></i> Add File</button>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden">
                        <table class="w-full text-left text-sm custom-table text-slate-600 dark:text-slate-300">
                            <thead class="bg-slate-50 dark:bg-slate-700/50"><tr><th class="px-6 py-4">File Name</th><th class="px-6 py-4">Category</th><th class="px-6 py-4 text-right">Actions</th></tr></thead>
                            <tbody id="downloads-list"></tbody>
                        </table>
                    </div>
                </div>

                <!-- 8. QUICK LINKS TAB -->
                <div id="tab-quicklinks" class="tab-content hidden space-y-6 animate-fade-in">
                    <div class="flex justify-between items-center bg-white dark:bg-slate-800 p-4 rounded-xl border dark:border-slate-700">
                        <h3 class="font-bold text-lg text-slate-800 dark:text-white">Quick Links</h3>
                        <div class="flex gap-2">
                            <div class="relative">
                                <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                                <input type="text" onkeyup="filterQuickLinks(this.value)" placeholder="Search Links..." class="pl-9 pr-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white text-sm focus:ring-2 focus:ring-blue-500 outline-none w-64">
                            </div>
                            <button onclick="loadQuickLinks()" class="bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 px-3 py-2 rounded-lg hover:bg-slate-200 transition"><i class="fas fa-sync-alt"></i></button>
                            <button onclick="openModal('quicklink-modal')" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-blue-700"><i class="fas fa-plus mr-2"></i> Add Link</button>
                        </div>
                    </div>
                    <div id="quicklinks-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                </div>

                <!-- 9. OFFICER MANAGEMENT (Updated Layout) -->
                <div id="tab-officers" class="tab-content hidden space-y-6 animate-fade-in">
                    <div class="flex justify-between items-center bg-white dark:bg-slate-800 p-4 rounded-xl border dark:border-slate-700">
                        <h3 class="font-bold text-lg text-slate-800 dark:text-white">Officer Management</h3>
                        <div class="flex gap-2">
                            <div class="relative">
                                <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                                <input type="text" onkeyup="filterOfficers(this.value)" placeholder="Search Officers..." class="pl-9 pr-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white text-sm focus:ring-2 focus:ring-blue-500 outline-none w-64">
                            </div>
                            <button onclick="loadOfficers()" class="bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 px-3 py-2 rounded-lg hover:bg-slate-200 transition"><i class="fas fa-sync-alt"></i></button>
                            <button onclick="openModal('officer-modal')" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-blue-700"><i class="fas fa-plus mr-2"></i> Add Officer</button>
                        </div>
                    </div>
                    <div id="officers-grid" class="space-y-4"></div>
                </div>

                <!-- 10. SPORTS TEAMS -->
                <div id="tab-sports" class="tab-content hidden space-y-6 animate-fade-in">
                    <div class="flex justify-between items-center bg-white dark:bg-slate-800 p-4 rounded-xl border dark:border-slate-700">
                        <h3 class="font-bold text-lg text-slate-800 dark:text-white">Sports Teams</h3>
                        <div class="flex gap-2">
                            <div class="relative">
                                <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                                <input type="text" onkeyup="filterSports(this.value)" placeholder="Search Sports..." class="pl-9 pr-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white text-sm focus:ring-2 focus:ring-blue-500 outline-none w-64">
                            </div>
                            <button onclick="loadSports()" class="bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 px-3 py-2 rounded-lg hover:bg-slate-200 transition"><i class="fas fa-sync-alt"></i></button>
                            <button onclick="openModal('sport-modal')" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-blue-700"><i class="fas fa-plus mr-2"></i> Add Team</button>
                        </div>
                    </div>
                    <div id="sports-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
                </div>

                <!-- 11. SETTINGS TAB -->
                <div id="tab-settings" class="tab-content hidden space-y-6 animate-fade-in">
                    <div class="bg-white dark:bg-slate-800 p-8 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 max-w-2xl">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="font-bold text-lg text-slate-800 dark:text-white">Site Configuration</h3>
                            <button onclick="loadSettings()" class="text-slate-400 hover:text-blue-600"><i class="fas fa-sync-alt"></i></button>
                        </div>
                        <form id="settings-form" class="space-y-4 text-slate-600 dark:text-slate-300">
                            <div>
                                <label class="block text-xs font-bold uppercase mb-1">Club Address</label>
                                <input type="text" id="set-address" class="w-full p-3 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white">
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-bold uppercase mb-1">Contact Phone</label>
                                    <input type="text" id="set-phone" class="w-full p-3 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold uppercase mb-1">Contact Email</label>
                                    <input type="email" id="set-email" class="w-full p-3 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white">
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs font-bold uppercase mb-1 text-blue-600 dark:text-blue-400">Super Admin WhatsApp</label>
                                <input type="text" id="set-super-wa" class="w-full p-3 rounded-lg border border-blue-200 dark:border-blue-900 dark:bg-slate-700 dark:text-white" placeholder="e.g. 9471XXXXXXX">
                            </div>
                            <div>
                                <label class="block text-xs font-bold uppercase mb-1">Admin Support WhatsApp</label>
                                <input type="text" id="set-admin-wa" class="w-full p-3 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white" placeholder="For notifications">
                            </div>
                            <hr class="border-slate-100 dark:border-slate-700 my-4">
                            <h4 class="font-bold text-sm">Social Media Links</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <input type="text" id="set-fb" placeholder="Facebook URL" class="w-full p-3 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white">
                                <input type="text" id="set-yt" placeholder="YouTube URL" class="w-full p-3 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white">
                                <input type="text" id="set-ig" placeholder="Instagram URL" class="w-full p-3 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white">
                                <input type="text" id="set-wa" placeholder="WhatsApp URL" class="w-full p-3 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white">
                            </div>
                            <button type="submit" class="bg-blue-900 hover:bg-blue-800 text-white px-6 py-3 rounded-xl font-bold w-full mt-4 shadow-lg transition">Save Changes</button>
                        </form>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- MODALS (Fixed) -->
    
    <!-- Admin Modal -->
    <div id="admin-modal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm hidden flex items-center justify-center p-4">
        <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 w-full max-w-lg shadow-2xl transform scale-95 transition-transform duration-300">
            <h3 class="font-bold text-lg mb-4 text-slate-800 dark:text-white">Manage Admin</h3>
            <form id="admin-form" class="space-y-4">
                <input type="hidden" id="admin-id">
                <input type="text" id="admin-name-input" placeholder="Full Name" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white" required>
                <input type="email" id="admin-email-input" placeholder="Email Address" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white" required>
                <input type="password" id="admin-password-input" placeholder="Password (Min 6 chars)" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                <p class="text-xs text-slate-400 -mt-2">Leave blank to keep existing password.</p>
                <div class="grid grid-cols-2 gap-4">
                    <input type="text" id="admin-phone-input" placeholder="Phone" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                    <select id="admin-status-input" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
                <div class="flex justify-end gap-3 mt-4">
                    <button type="button" onclick="closeModal('admin-modal')" class="px-4 py-2 text-slate-500 font-bold hover:text-slate-700 dark:hover:text-slate-300">Cancel</button>
                    <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Member Modal -->
    <div id="member-modal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm hidden flex items-center justify-center p-4">
        <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 w-full max-w-lg overflow-y-auto max-h-[90vh] shadow-2xl">
            <h3 class="font-bold text-lg mb-4 text-slate-800 dark:text-white">Member Details</h3>
            <form id="member-form" class="space-y-4">
                <input type="hidden" id="mem-id">
                <input type="text" id="mem-name" placeholder="Full Name" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white" required>
                <input type="text" id="mem-nic" placeholder="NIC" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white" required>
                <div class="grid grid-cols-2 gap-4">
                    <input type="text" id="mem-phone" placeholder="Phone" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white" required>
                    <input type="text" id="mem-whatsapp" placeholder="WhatsApp" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                </div>
                <input type="email" id="mem-email" placeholder="Email (Optional)" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                <input type="text" id="mem-address" placeholder="Address" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                <input type="date" id="mem-dob" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                <textarea id="mem-bio" rows="2" placeholder="Bio/Skills" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white"></textarea>
                <div class="flex justify-end gap-3 mt-4">
                    <button type="button" onclick="closeModal('member-modal')" class="px-4 py-2 text-slate-500 font-bold hover:text-slate-700 dark:hover:text-slate-300">Cancel</button>
                    <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Officer Modal -->
    <div id="officer-modal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm hidden flex items-center justify-center p-4">
        <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 w-full max-w-lg shadow-2xl">
            <h3 class="font-bold text-lg mb-4 text-slate-800 dark:text-white">Add/Edit Officer</h3>
            <form id="officer-form" class="space-y-4">
                <input type="hidden" id="off-id">
                <input type="text" id="off-name" placeholder="Name" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white" required>
                <input type="text" id="off-pos" placeholder="Position" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white" required>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-slate-500 dark:text-slate-400">Date of Birth</label>
                        <input type="date" id="off-dob" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-500 dark:text-slate-400">Appointed Date</label>
                        <input type="date" id="off-appointed" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                    </div>
                </div>

                <div>
                    <div class="flex justify-between items-center mb-1">
                        <label class="text-xs font-bold text-slate-500 dark:text-slate-400">Email Address</label>
                        <div class="flex items-center gap-2">
                            <input type="checkbox" id="off-show-email" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded">
                            <label for="off-show-email" class="text-xs text-slate-400">Public Visible</label>
                        </div>
                    </div>
                    <input type="email" id="off-email" placeholder="Email" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                </div>

                <div>
                    <div class="flex justify-between items-center mb-1">
                        <label class="text-xs font-bold text-slate-500 dark:text-slate-400">Phone Number</label>
                        <div class="flex items-center gap-2">
                            <input type="checkbox" id="off-show-phone" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded">
                            <label for="off-show-phone" class="text-xs text-slate-400">Public Visible</label>
                        </div>
                    </div>
                    <input type="text" id="off-phone" placeholder="Phone" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                </div>

                <div class="space-y-2">
                    <label class="text-xs font-bold text-slate-500 dark:text-slate-400">Profile Image</label>
                    <div class="flex gap-2">
                        <input type="text" id="off-img" placeholder="Paste URL here..." class="flex-1 p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                        <span class="text-sm self-center text-slate-400">OR</span>
                        <input type="file" id="off-file" class="w-1/3 text-xs dark:text-slate-300" accept="image/*">
                    </div>
                </div>

                <input type="number" id="off-order" placeholder="Display Order" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                <div class="flex justify-end gap-3 mt-4">
                    <button type="button" onclick="closeModal('officer-modal')" class="px-4 py-2 text-slate-500 font-bold hover:text-slate-700 dark:hover:text-slate-300">Cancel</button>
                    <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Sport Modal -->
    <div id="sport-modal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm hidden flex items-center justify-center p-4">
        <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 w-full max-w-lg shadow-2xl">
            <h3 class="font-bold text-lg mb-4 text-slate-800 dark:text-white">Sports Team</h3>
            <form id="sport-form" class="space-y-4">
                <input type="hidden" id="sport-id">
                <input type="text" id="sport-name" placeholder="Sport Name" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white" required>
                <input type="text" id="sport-captain" placeholder="Captain Name" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                
                <div class="space-y-2">
                    <label class="text-xs font-bold text-slate-500 dark:text-slate-400">Team Photo</label>
                    <div class="flex gap-2">
                        <input type="text" id="sport-img" placeholder="Paste URL here..." class="flex-1 p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                        <span class="text-sm self-center text-slate-400">OR</span>
                        <input type="file" id="sport-file" class="w-1/3 text-xs dark:text-slate-300" accept="image/*">
                    </div>
                </div>

                <textarea id="sport-desc" placeholder="Description" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white"></textarea>
                <div class="flex justify-end gap-3 mt-4">
                    <button type="button" onclick="closeModal('sport-modal')" class="px-4 py-2 text-slate-500 font-bold hover:text-slate-700 dark:hover:text-slate-300">Cancel</button>
                    <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Download Modal -->
    <div id="download-modal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm hidden flex items-center justify-center p-4">
        <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 w-full max-w-lg shadow-2xl">
            <h3 class="font-bold text-lg mb-4 text-slate-800 dark:text-white">Download Item</h3>
            <form id="download-form" class="space-y-4">
                <input type="hidden" id="dl-id">
                <input type="text" id="dl-name" placeholder="File Name" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white" required>
                <input type="text" id="dl-url" placeholder="File URL / Drive Link" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white" required>
                <input type="text" id="dl-cat" placeholder="Category (e.g. PDF, Image)" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                <div class="flex justify-end gap-3 mt-4">
                    <button type="button" onclick="closeModal('download-modal')" class="px-4 py-2 text-slate-500 font-bold hover:text-slate-700 dark:hover:text-slate-300">Cancel</button>
                    <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Quick Link Modal -->
    <div id="quicklink-modal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm hidden flex items-center justify-center p-4">
        <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 w-full max-w-lg shadow-2xl">
            <h3 class="font-bold text-lg mb-4 text-slate-800 dark:text-white">Quick Link</h3>
            <form id="quicklink-form" class="space-y-4">
                <input type="hidden" id="ql-id">
                <input type="text" id="ql-title" placeholder="Link Title" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white" required>
                <input type="text" id="ql-url" placeholder="URL" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white" required>
                <textarea id="ql-desc" placeholder="Short Description" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white"></textarea>
                <div class="flex justify-end gap-3 mt-4">
                    <button type="button" onclick="closeModal('quicklink-modal')" class="px-4 py-2 text-slate-500 font-bold hover:text-slate-700 dark:hover:text-slate-300">Cancel</button>
                    <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Event Modal -->
    <div id="event-modal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm hidden flex items-center justify-center p-4">
        <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 w-full max-w-lg shadow-2xl">
            <h3 class="font-bold text-lg mb-4 text-slate-800 dark:text-white">Add/Edit Event</h3>
            <form id="event-form" class="space-y-4">
                <input type="hidden" id="event-id">
                <input type="text" id="event-title" placeholder="Event Title" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white" required>
                <textarea id="event-desc" placeholder="Description" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white" rows="3"></textarea>
                <div class="grid grid-cols-2 gap-4">
                    <input type="date" id="event-date" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white" required>
                    <input type="time" id="event-time" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                </div>
                
                <div class="space-y-2">
                    <label class="text-xs font-bold text-slate-500 dark:text-slate-400">Cover Image</label>
                    <div class="flex gap-2">
                        <input type="text" id="event-img" placeholder="Paste URL here..." class="flex-1 p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                        <span class="text-sm self-center text-slate-400">OR</span>
                        <input type="file" id="event-file" class="w-1/3 text-xs dark:text-slate-300" accept="image/*">
                    </div>
                </div>

                <div class="flex justify-end gap-3 mt-4">
                    <button type="button" onclick="closeModal('event-modal')" class="px-4 py-2 text-slate-500 font-bold hover:text-slate-700 dark:hover:text-slate-300">Cancel</button>
                    <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Album Modal -->
    <div id="album-modal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm hidden flex items-center justify-center p-4">
        <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 w-full max-w-lg shadow-2xl">
            <h3 class="font-bold text-lg mb-4 text-slate-800 dark:text-white">Album</h3>
            <form id="album-form" class="space-y-4">
                <input type="hidden" id="album-id">
                <input type="text" id="album-title" placeholder="Album Title" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white" required>
                <input type="date" id="album-date" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white" required>
                <div class="space-y-2">
                    <label class="text-xs font-bold text-slate-500 dark:text-slate-400">Cover Image</label>
                    <div class="flex gap-2">
                        <input type="text" id="album-cover" placeholder="Paste URL here..." class="flex-1 p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                        <span class="text-sm self-center text-slate-400">OR</span>
                        <input type="file" id="album-file" class="w-1/3 text-xs dark:text-slate-300" accept="image/*">
                    </div>
                </div>
                <div class="flex justify-end gap-3 mt-4">
                    <button type="button" onclick="closeModal('album-modal')" class="px-4 py-2 text-slate-500 font-bold hover:text-slate-700 dark:hover:text-slate-300">Cancel</button>
                    <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Image Modal (Updated for Multiple) -->
    <div id="image-modal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm hidden flex items-center justify-center p-4">
        <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 w-full max-w-lg shadow-2xl">
            <h3 class="font-bold text-lg mb-4 text-slate-800 dark:text-white">Add Images (Up to 50)</h3>
            <form id="image-form" class="space-y-4">
                <div class="space-y-2">
                    <label class="text-xs font-bold text-slate-500 dark:text-slate-400">Select Images</label>
                    <div class="flex gap-2">
                        <!-- Changed to allow multiple -->
                        <input type="file" id="img-files" class="w-full text-xs dark:text-slate-300 border p-3 rounded-lg border-slate-200 dark:border-slate-700" accept="image/*" multiple>
                    </div>
                    <p class="text-[10px] text-slate-400">Hold Ctrl/Cmd to select multiple files.</p>
                </div>
                
                <!-- Optional Single URL fallback hidden or secondary -->
                <input type="text" id="img-url" placeholder="Or paste single image URL..." class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white text-sm">
                
                <input type="text" id="img-caption" placeholder="Caption (Optional)" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                
                <div class="flex justify-end gap-3 mt-4">
                    <button type="button" onclick="closeModal('image-modal')" class="px-4 py-2 text-slate-500 font-bold hover:text-slate-700 dark:hover:text-slate-300">Cancel</button>
                    <button type="submit" class="px-6 py-2 bg-green-600 text-white rounded-lg font-bold hover:bg-green-700">Upload All</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Slide Modal -->
    <div id="slide-modal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm hidden flex items-center justify-center p-4">
        <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 w-full max-w-lg shadow-2xl">
            <h3 class="font-bold text-lg mb-4 text-slate-800 dark:text-white">Slide Item</h3>
            <form id="slide-form" class="space-y-4">
                <input type="hidden" id="slide-id">
                <div class="space-y-2">
                    <label class="text-xs font-bold text-slate-500 dark:text-slate-400">Slide Image</label>
                    <div class="flex gap-2">
                        <input type="text" id="slide-url" placeholder="Paste URL here..." class="flex-1 p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                        <span class="text-sm self-center text-slate-400">OR</span>
                        <input type="file" id="slide-file" class="w-1/3 text-xs dark:text-slate-300" accept="image/*">
                    </div>
                </div>
                <input type="number" id="slide-order" placeholder="Display Order (e.g. 1)" class="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white" required>
                <div class="flex justify-end gap-3 mt-4">
                    <button type="button" onclick="closeModal('slide-modal')" class="px-4 py-2 text-slate-500 font-bold hover:text-slate-700 dark:hover:text-slate-300">Cancel</button>
                    <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- FIREBASE SDK & LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyD6yXDHsOaqVplfhsXZV8nWvMuioDulwYg",
            authDomain: "edu-login-4d05f.firebaseapp.com",
            projectId: "edu-login-4d05f",
            storageBucket: "edu-login-4d05f.firebasestorage.app",
            messagingSenderId: "197092856272",
            appId: "1:197092856272:web:a00b0169e46e7d5acca9d5",
            measurementId: "G-TM21CT4GJ9"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        const SUPER_ADMIN_UID = "73KustyeOpUsTGTqQBVeQP3LUBF2";

        document.getElementById('google-login-btn').addEventListener('click', async () => {
            try {
                showLoading();
                const result = await signInWithPopup(auth, provider);
                const user = result.user;
                const email = user.email;
                const uid = user.uid;

                if (uid === SUPER_ADMIN_UID) {
                    const { data, error } = await supabaseClient
                        .from('admins')
                        .select('*')
                        .eq('email', email)
                        .maybeSingle();

                    if (data) {
                        data.role = 'super_admin'; 
                        window.handleLoginSuccess(data, uid);
                    } else {
                        const newAdmin = { 
                            id: 9999, 
                            name: user.displayName || 'Super Admin', 
                            email: email, 
                            role: 'super_admin', 
                            status: 'active' 
                        };
                        window.handleLoginSuccess(newAdmin, uid);
                    }
                } else {
                    alert("Access Denied: Only designated Super Admin can login.");
                    auth.signOut();
                    hideLoading();
                }
            } catch (error) {
                console.error("Google Login Error:", error);
                alert("Google Sign-In failed.");
                hideLoading();
            }
        });
    </script>

    <!-- MAIN APP LOGIC -->
    <script>
        const supabaseUrl = 'https://yzlgnavevrvikaolxorg.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl6bGduYXZldnJ2aWthb2x4b3JnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYzNjQyODEsImV4cCI6MjA4MTk0MDI4MX0.17BpZteoYnIYZsCs1f90VGMYnmYW6AHeXO4-1yYB7Ts';
        window.supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

        let currentAdmin = null;
        let activeAlbumId = null;
        
        let globalMembers = [];
        let globalEvents = [];
        let globalAdmins = [];
        let globalMessages = [];
        let globalAlbums = [];
        let globalDownloads = [];
        let globalQuickLinks = [];
        let globalOfficers = [];
        let globalSports = [];

        // UI HELPERS
        function showLoading() { document.getElementById('loading-overlay').classList.add('active'); }
        function hideLoading() { document.getElementById('loading-overlay').classList.remove('active'); }
        
        function toggleTheme() {
            const html = document.documentElement;
            if(html.classList.contains('dark')) {
                html.classList.remove('dark');
                localStorage.setItem('theme', 'light');
                document.getElementById('theme-status').innerText = 'Light';
            } else {
                html.classList.add('dark');
                localStorage.setItem('theme', 'dark');
                document.getElementById('theme-status').innerText = 'Dark';
            }
        }
        
        // Init Theme
        if(localStorage.getItem('theme') === 'dark') {
            document.documentElement.classList.add('dark');
            document.getElementById('theme-status').innerText = 'Dark';
        }

        window.handleLoginSuccess = async function(adminData, uid = null) {
            currentAdmin = adminData;
            
            if(adminData.id !== 9999) { 
                await window.supabaseClient.from('admins').update({ last_login: new Date().toISOString() }).eq('id', adminData.id);
            }

            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('app-container').classList.remove('hidden');
            document.getElementById('admin-name').innerText = adminData.name;
            document.getElementById('admin-role').innerText = adminData.role || 'Admin';
            
            const SUPER_ADMIN_UID_CHECK = "73KustyeOpUsTGTqQBVeQP3LUBF2";
            if (uid === SUPER_ADMIN_UID_CHECK || adminData.email === 'isaradilnuka2005@gmail.com') {
                document.getElementById('user-avatar').src = "https://isaradilnuka.netlify.app/isara-profile.jpg";
            }

            if(adminData.role === 'super_admin') {
                document.getElementById('super-admin-menu').classList.remove('hidden');
            }
            initDashboard();
            hideLoading();
        }

        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            showLoading();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const { data, error } = await window.supabaseClient.from('admins').select('*').eq('email', email).eq('password', password).maybeSingle();
            if (data) {
                if(data.status === 'inactive') {
                    alert("Account deactivated.");
                    hideLoading();
                    return;
                }
                window.handleLoginSuccess(data);
            } else {
                alert("Invalid credentials.");
                hideLoading();
            }
        });

        window.forgotPassword = async function() {
            showLoading();
            const { data } = await window.supabaseClient.from('site_settings').select('super_admin_whatsapp').limit(1).maybeSingle();
            hideLoading();
            const waNumber = (data && data.super_admin_whatsapp) ? data.super_admin_whatsapp : '94716155666'; 
            window.open(`https://wa.me/${waNumber.replace('+', '')}?text=I forgot my Admin Password. Please assist.`, '_blank');
        }

        function logout() { window.location.reload(); }

        window.switchTab = function(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(`tab-${tabId}`).classList.remove('hidden');
            document.getElementById('page-title').innerText = tabId.charAt(0).toUpperCase() + tabId.slice(1);
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active', 'bg-slate-800'));
            
            if(tabId === 'members') loadMembers();
            if(tabId === 'events') loadEvents();
            if(tabId === 'gallery') loadAlbums();
            if(tabId === 'slideshow') loadSlides();
            if(tabId === 'downloads') loadDownloads();
            if(tabId === 'quicklinks') loadQuickLinks();
            if(tabId === 'settings') loadSettings();
            if(tabId === 'admins') loadAdmins();
            if(tabId === 'messages') loadMessages();
            if(tabId === 'officers') loadOfficers();
            if(tabId === 'sports') loadSports();
        }

        // Image Upload Helper (FIXED)
        async function uploadFile(file) {
            if (!file) return null;
            
            const fileExt = file.name.split('.').pop();
            const fileName = `${Date.now()}_${Math.floor(Math.random() * 1000)}.${fileExt}`;
            const filePath = `${fileName}`;
            
            const { data, error } = await window.supabaseClient.storage
                .from('images')
                .upload(filePath, file, {
                    cacheControl: '3600',
                    upsert: false
                });
            
            if (error) {
                console.error("Upload Error Details:", error);
                return null;
            }
            
            const { data: publicUrlData } = window.supabaseClient.storage
                .from('images')
                .getPublicUrl(filePath);
                
            if (!publicUrlData || !publicUrlData.publicUrl) {
                console.error("Failed to get public URL");
                return null;
            }

            return publicUrlData.publicUrl;
        }

        // --- DASHBOARD ---
        async function initDashboard() {
            const { count: mCount } = await window.supabaseClient.from('members').select('*', { count: 'exact', head: true });
            document.getElementById('dash-total-members').innerText = mCount || 0;
            const { count: pCount } = await window.supabaseClient.from('members').select('*', { count: 'exact', head: true }).eq('status', 'pending');
            document.getElementById('dash-pending-members').innerText = pCount || 0;
            const { count: eCount } = await window.supabaseClient.from('events').select('*', { count: 'exact', head: true });
            document.getElementById('dash-total-events').innerText = eCount || 0;
            const { count: msgCount } = await window.supabaseClient.from('messages').select('*', { count: 'exact', head: true });
            document.getElementById('dash-total-msgs').innerText = msgCount || 0;

            const ctx1 = document.getElementById('memberChart');
            if(ctx1) new Chart(ctx1, { 
                type: 'line', 
                data: { 
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'], 
                    datasets: [{ 
                        label: 'Growth', 
                        data: [10, 15, 25, 30, 45, mCount || 50], 
                        borderColor: '#2563eb', 
                        backgroundColor: 'rgba(37, 99, 235, 0.1)', 
                        fill: true,
                        tension: 0.4 
                    }] 
                } 
            });
            const ctx2 = document.getElementById('activityChart');
            if(ctx2) new Chart(ctx2, { 
                type: 'bar', 
                data: { 
                    labels: ['Events', 'Members', 'Messages'], 
                    datasets: [{ 
                        label: 'Count', 
                        data: [eCount || 0, mCount || 0, msgCount || 0], 
                        backgroundColor: ['#8b5cf6', '#3b82f6', '#10b981'] 
                    }] 
                } 
            });
        }

        // --- MEMBERS ---
        async function loadMembers() {
            showLoading();
            const { data } = await window.supabaseClient.from('members').select('*').order('created_at', { ascending: false });
            globalMembers = data || [];
            renderMembers(globalMembers);
            hideLoading();
        }

        function renderMembers(data) {
            const tbody = document.getElementById('members-table-body');
            tbody.innerHTML = '';
            if(data) data.forEach(m => {
                const isHidden = m.status === 'inactive' || m.status === 'pending';
                const eyeIcon = isHidden ? 'fa-eye-slash' : 'fa-eye';
                const statusAction = m.status === 'pending' ? 'active' : (m.status === 'active' ? 'inactive' : 'active');
                
                const actions = `
                    <button onclick="updateMemberStatus(${m.id}, '${statusAction}')" class="text-slate-500 mr-2 hover:scale-110 transition" title="Toggle Status"><i class="fas ${eyeIcon}"></i></button>
                    <button onclick="editMember(${m.id})" class="text-blue-500 mr-2 hover:scale-110 transition"><i class="fas fa-edit"></i></button>
                    <button onclick="deleteMember(${m.id})" class="text-red-400 hover:scale-110 transition"><i class="fas fa-trash"></i></button>`;
                
                tbody.innerHTML += `<tr><td class="px-6 py-4">${m.full_name}</td><td class="px-6 py-4 text-xs">${m.phone}</td><td class="px-6 py-4"><span class="px-2 py-1 rounded text-xs ${m.status==='active'?'bg-green-100 text-green-700':'bg-orange-100 text-orange-700'}">${m.status}</span></td><td class="px-6 py-4 text-right">${actions}</td></tr>`;
            });
        }

        window.filterMembers = function(query) {
            const filtered = globalMembers.filter(m => m.full_name.toLowerCase().includes(query.toLowerCase()) || m.nic.includes(query) || m.phone.includes(query));
            renderMembers(filtered);
        }

        window.filterMembersByStatus = function(status) {
            if(status === 'all') renderMembers(globalMembers);
            else {
                const filtered = globalMembers.filter(m => m.status === status);
                renderMembers(filtered);
            }
        }
        
        window.editMember = async function(id) {
            const { data } = await window.supabaseClient.from('members').select('*').eq('id', id).single();
            if(data) {
                document.getElementById('mem-id').value = data.id;
                document.getElementById('mem-name').value = data.full_name;
                document.getElementById('mem-nic').value = data.nic || '';
                document.getElementById('mem-phone').value = data.phone || '';
                document.getElementById('mem-whatsapp').value = data.whatsapp || '';
                document.getElementById('mem-email').value = data.email || '';
                document.getElementById('mem-address').value = data.address || '';
                document.getElementById('mem-dob').value = data.dob || '';
                document.getElementById('mem-bio').value = data.bio || '';
                openModal('member-modal');
            }
        };

        document.getElementById('member-form').addEventListener('submit', async(e) => {
            e.preventDefault();
            showLoading();
            const id = document.getElementById('mem-id').value;
            const payload = {
                full_name: document.getElementById('mem-name').value,
                nic: document.getElementById('mem-nic').value,
                phone: document.getElementById('mem-phone').value,
                whatsapp: document.getElementById('mem-whatsapp').value,
                email: document.getElementById('mem-email').value,
                address: document.getElementById('mem-address').value,
                dob: document.getElementById('mem-dob').value,
                bio: document.getElementById('mem-bio').value,
                status: 'active'
            };
            
            if(id) await window.supabaseClient.from('members').update(payload).eq('id', id);
            else await window.supabaseClient.from('members').insert([payload]);
            
            closeModal('member-modal'); loadMembers();
        });

        window.updateMemberStatus = async function(id, status) { await window.supabaseClient.from('members').update({ status }).eq('id', id); loadMembers(); }
        window.deleteMember = async function(id) { if(confirm("Delete?")) { await window.supabaseClient.from('members').delete().eq('id', id); loadMembers(); } }
        window.filterMembers = function(s) { loadMembers(); }

        // --- EVENTS ---
        async function loadEvents() {
            showLoading();
            const { data } = await window.supabaseClient.from('events').select('*');
            globalEvents = data || [];
            renderEvents(globalEvents);
            hideLoading();
        }

        function renderEvents(data) {
            const grid = document.getElementById('events-grid');
            grid.innerHTML = '';
            if(data) data.forEach(e => { grid.innerHTML += `<div class="bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-100 dark:border-slate-700 relative group"><img src="${e.cover_image_url}" class="w-full h-32 object-cover rounded mb-2"><h4 class="font-bold dark:text-white">${e.title}</h4><div class="absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition"><button onclick="editEvent(${e.id})" class="bg-white text-blue-500 p-1 rounded shadow"><i class="fas fa-edit"></i></button><button onclick="deleteEvent(${e.id})" class="bg-white text-red-500 p-1 rounded shadow"><i class="fas fa-trash"></i></button></div></div>`; });
        }

        window.filterEvents = function(query) {
            const filtered = globalEvents.filter(e => e.title.toLowerCase().includes(query.toLowerCase()));
            renderEvents(filtered);
        }

        window.editEvent = async function(id) {
            const { data } = await window.supabaseClient.from('events').select('*').eq('id', id).single();
            if(data) {
                document.getElementById('event-id').value = data.id;
                document.getElementById('event-title').value = data.title;
                document.getElementById('event-desc').value = data.description;
                document.getElementById('event-date').value = data.event_date;
                document.getElementById('event-time').value = data.event_time;
                document.getElementById('event-img').value = data.cover_image_url;
                openModal('event-modal');
            }
        }

        document.getElementById('event-form').addEventListener('submit', async (e) => { 
            e.preventDefault(); showLoading();
            const id = document.getElementById('event-id').value;
            const file = document.getElementById('event-file').files[0];
            let url = document.getElementById('event-img').value;
            if(file) { url = await uploadFile(file); }
            
            const payload = { title: document.getElementById('event-title').value, description: document.getElementById('event-desc').value, event_date: document.getElementById('event-date').value, event_time: document.getElementById('event-time').value, cover_image_url: url };
            
            if(id) await window.supabaseClient.from('events').update(payload).eq('id', id);
            else await window.supabaseClient.from('events').insert([payload]);
            
            closeModal('event-modal'); loadEvents(); 
        });
        window.deleteEvent = async function(id) { if(confirm("Delete?")) { await window.supabaseClient.from('events').delete().eq('id', id); loadEvents(); } }

        // --- DOWNLOADS ---
        async function loadDownloads() {
            showLoading();
            const { data } = await window.supabaseClient.from('downloads').select('*');
            globalDownloads = data || [];
            renderDownloads(globalDownloads);
            hideLoading();
        }

        function renderDownloads(data) {
            const list = document.getElementById('downloads-list');
            list.innerHTML = '';
            if(data) data.forEach(d => {
                list.innerHTML += `<tr><td class="px-6 py-4">${d.file_name}</td><td class="px-6 py-4">${d.category}</td><td class="px-6 py-4 text-right"><button onclick="editDownload(${d.id})" class="text-blue-500 mr-2"><i class="fas fa-edit"></i></button><button onclick="deleteDownload(${d.id})" class="text-red-500"><i class="fas fa-trash"></i></button></td></tr>`;
            });
        }

        window.filterDownloads = function(query) {
            const filtered = globalDownloads.filter(d => d.file_name.toLowerCase().includes(query.toLowerCase()));
            renderDownloads(filtered);
        }
        
        window.editDownload = async function(id) {
            const { data } = await window.supabaseClient.from('downloads').select('*').eq('id', id).single();
            if(data) {
                document.getElementById('dl-id').value = data.id;
                document.getElementById('dl-name').value = data.file_name;
                document.getElementById('dl-url').value = data.file_url;
                document.getElementById('dl-cat').value = data.category;
                openModal('download-modal');
            }
        }

        document.getElementById('download-form').addEventListener('submit', async (e) => {
            e.preventDefault(); showLoading();
            const id = document.getElementById('dl-id').value;
            const payload = { file_name: document.getElementById('dl-name').value, file_url: document.getElementById('dl-url').value, category: document.getElementById('dl-cat').value };
            
            if(id) await window.supabaseClient.from('downloads').update(payload).eq('id', id);
            else await window.supabaseClient.from('downloads').insert([payload]);
            
            closeModal('download-modal'); loadDownloads();
        });
        window.deleteDownload = async function(id) { if(confirm("Delete file?")) { await window.supabaseClient.from('downloads').delete().eq('id', id); loadDownloads(); } }

        // --- QUICK LINKS ---
        async function loadQuickLinks() {
            showLoading();
            const { data } = await window.supabaseClient.from('quick_links').select('*');
            globalQuickLinks = data || [];
            renderQuickLinks(globalQuickLinks);
            hideLoading();
        }

        function renderQuickLinks(data) {
            const list = document.getElementById('quicklinks-list');
            list.innerHTML = '';
            if(data) data.forEach(q => {
                const eye = q.is_active ? 'fa-eye' : 'fa-eye-slash';
                list.innerHTML += `
                <div class="relative group bg-white/50 dark:bg-slate-800/50 backdrop-blur-sm p-5 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 opacity-0 group-hover:opacity-100 transition duration-500"></div>
                    <div class="relative z-10 flex justify-between items-start">
                        <div>
                            <h4 class="font-bold text-lg text-slate-800 dark:text-white mb-1 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition">${q.title}</h4>
                            <a href="${q.link_url}" target="_blank" class="text-xs text-slate-500 truncate block max-w-[200px] hover:underline">${q.link_url}</a>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="toggleLink(${q.id}, ${q.is_active})" class="w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-700 flex items-center justify-center text-slate-500 hover:text-blue-600 transition"><i class="fas ${eye}"></i></button>
                            <button onclick="editQuickLink(${q.id})" class="w-8 h-8 rounded-full bg-blue-50 dark:bg-blue-900/30 flex items-center justify-center text-blue-500 hover:text-blue-700 transition"><i class="fas fa-edit"></i></button>
                            <button onclick="deleteQuickLink(${q.id})" class="w-8 h-8 rounded-full bg-red-50 dark:bg-red-900/30 flex items-center justify-center text-red-500 hover:text-red-700 transition"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                    <p class="text-sm text-slate-600 dark:text-slate-400 mt-3 line-clamp-2 relative z-10">${q.description || 'No description'}</p>
                </div>`;
            });
        }

        window.filterQuickLinks = function(query) {
            const filtered = globalQuickLinks.filter(q => q.title.toLowerCase().includes(query.toLowerCase()));
            renderQuickLinks(filtered);
        }
        
        window.editQuickLink = async function(id) {
            const { data } = await window.supabaseClient.from('quick_links').select('*').eq('id', id).single();
            if(data) {
                document.getElementById('ql-id').value = data.id;
                document.getElementById('ql-title').value = data.title;
                document.getElementById('ql-url').value = data.link_url;
                document.getElementById('ql-desc').value = data.description;
                openModal('quicklink-modal');
            }
        }

        document.getElementById('quicklink-form').addEventListener('submit', async (e) => {
            e.preventDefault(); showLoading();
            const id = document.getElementById('ql-id').value;
            const payload = { title: document.getElementById('ql-title').value, link_url: document.getElementById('ql-url').value, description: document.getElementById('ql-desc').value, is_active: true };
            
            if(id) await window.supabaseClient.from('quick_links').update(payload).eq('id', id);
            else await window.supabaseClient.from('quick_links').insert([payload]);
            
            closeModal('quicklink-modal'); loadQuickLinks();
        });
        window.toggleLink = async function(id, current) { await window.supabaseClient.from('quick_links').update({ is_active: !current }).eq('id', id); loadQuickLinks(); }
        window.deleteQuickLink = async function(id) { if(confirm("Delete link?")) { await window.supabaseClient.from('quick_links').delete().eq('id', id); loadQuickLinks(); } }

        // --- ALBUMS ---
        async function loadAlbums() {
            showLoading();
            const { data } = await window.supabaseClient.from('gallery_albums').select('*');
            globalAlbums = data || [];
            renderAlbums(globalAlbums);
            hideLoading();
        }

        function renderAlbums(data) {
            const list = document.getElementById('albums-list');
            list.innerHTML = '';
            if(data) data.forEach(a => { 
                const eye = a.is_hidden ? 'fa-eye-slash' : 'fa-eye';
                list.innerHTML += `<div onclick="manageAlbum(${a.id}, '${a.title}')" class="bg-white dark:bg-slate-800 p-4 rounded-xl border dark:border-slate-700 cursor-pointer hover:shadow-lg relative group"><img src="${a.cover_image_url}" class="w-full h-32 object-cover rounded mb-2"><h4 class="font-bold dark:text-white">${a.title}</h4><div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100"><button onclick="event.stopPropagation(); toggleAlbum(${a.id}, ${a.is_hidden})" class="bg-white p-1 rounded mr-1"><i class="fas ${eye}"></i></button><button onclick="event.stopPropagation(); editAlbum(${a.id})" class="bg-white text-blue-500 p-1 rounded mr-1"><i class="fas fa-edit"></i></button><button onclick="event.stopPropagation(); deleteAlbum(${a.id})" class="bg-white text-red-500 p-1 rounded"><i class="fas fa-trash"></i></button></div></div>`; 
            });
        }

        window.filterAlbums = function(query) {
            const filtered = globalAlbums.filter(a => a.title.toLowerCase().includes(query.toLowerCase()));
            renderAlbums(filtered);
        }
        
        window.editAlbum = async function(id) {
            const { data } = await window.supabaseClient.from('gallery_albums').select('*').eq('id', id).single();
            if(data) {
                document.getElementById('album-id').value = data.id;
                document.getElementById('album-title').value = data.title;
                document.getElementById('album-date').value = data.event_date;
                document.getElementById('album-cover').value = data.cover_image_url;
                openModal('album-modal');
            }
        }

        document.getElementById('album-form').addEventListener('submit', async (e) => { 
            e.preventDefault(); showLoading();
            const id = document.getElementById('album-id').value;
            const file = document.getElementById('album-file').files[0];
            let url = document.getElementById('album-cover').value;
            if(file) { url = await uploadFile(file); }
            
            const payload = { title: document.getElementById('album-title').value, event_date: document.getElementById('album-date').value, cover_image_url: url };
            
            if(id) await window.supabaseClient.from('gallery_albums').update(payload).eq('id', id);
            else await window.supabaseClient.from('gallery_albums').insert([payload]);
            
            closeModal('album-modal'); loadAlbums(); 
        });
        window.manageAlbum = function(id, title) { activeAlbumId = id; document.getElementById('albums-list').classList.add('hidden'); document.getElementById('album-manager').classList.remove('hidden'); document.getElementById('manage-album-title').innerText = title; loadAlbumImages(id); }
        window.closeAlbumManager = function() { document.getElementById('album-manager').classList.add('hidden'); document.getElementById('albums-list').classList.remove('hidden'); }
        async function loadAlbumImages(id) { 
            const { data } = await window.supabaseClient.from('gallery_images').select('*').eq('album_id', id); 
            const g = document.getElementById('album-images-grid'); g.innerHTML = ''; 
            if(data) data.forEach(i => g.innerHTML += `<div class="relative"><img src="${i.image_url}" class="w-full h-24 object-cover rounded"><button onclick="deleteImage(${i.id})" class="absolute top-0 right-0 bg-red-500 text-white p-1 rounded-bl"><i class="fas fa-times"></i></button></div>`); 
        }
        
        // --- BULK IMAGE UPLOAD (ROBUST FIX) ---
        document.getElementById('image-form').addEventListener('submit', async (e) => { 
            e.preventDefault(); 
            showLoading();
            const files = document.getElementById('img-files').files;
            const caption = document.getElementById('img-caption').value; // Get caption once
            
            if (files.length > 50) {
                alert("Please select fewer than 50 images.");
                hideLoading();
                return;
            }

            if (files.length > 0) {
                // Bulk Upload Loop
                let successCount = 0;
                
                for(let i = 0; i < files.length; i++) {
                    const file = files[i];
                    document.getElementById('loading-text').innerText = `Uploading ${i+1}/${files.length}`;
                    
                    try {
                        const url = await uploadFile(file);
                        
                        if(url) {
                            // Insert into database ONLY if upload succeeded
                            const { error: dbError } = await window.supabaseClient
                                .from('gallery_images')
                                .insert([{ 
                                    album_id: activeAlbumId, 
                                    image_url: url, 
                                    caption: caption 
                                }]);
                            
                            if (!dbError) successCount++;
                            else console.error("DB Insert Error:", dbError);
                        } else {
                            console.error(`Skipping file ${i+1} due to upload failure (URL null).`);
                        }
                    } catch (error) {
                        console.error(`Failed to process file ${i+1}:`, error);
                    }
                    
                    // Small delay to prevent network throttling
                    await new Promise(r => setTimeout(r, 100));
                }
                
                if (successCount === 0) alert("Failed to upload images. Please check your connection or permissions.");
                else if (successCount < files.length) alert(`Uploaded ${successCount} out of ${files.length} images.`);
                
            } else {
                // Handle single URL input case
                const urlInput = document.getElementById('img-url').value;
                if(urlInput) {
                    await window.supabaseClient.from('gallery_images').insert([{ 
                        album_id: activeAlbumId, 
                        image_url: urlInput, 
                        caption: document.getElementById('img-caption').value 
                    }]);
                }
            }
            
            closeModal('image-modal'); 
            loadAlbumImages(activeAlbumId); 
            hideLoading();
            document.getElementById('loading-text').innerText = "Please wait";
            // Clear input
            document.getElementById('img-files').value = "";
            document.getElementById('img-url').value = "";
        });

        window.deleteImage = async function(id) { await window.supabaseClient.from('gallery_images').delete().eq('id', id); loadAlbumImages(activeAlbumId); }
        window.deleteAlbum = async function(id) { if(confirm("Delete Album?")) { await window.supabaseClient.from('gallery_albums').delete().eq('id', id); loadAlbums(); } }
        window.toggleAlbum = async function(id, current) { await window.supabaseClient.from('gallery_albums').update({ is_hidden: !current }).eq('id', id); loadAlbums(); }

        // --- SLIDESHOW ---
        async function loadSlides() {
            showLoading();
            const { data } = await window.supabaseClient.from('slideshow_images').select('*').order('display_order');
            const list = document.getElementById('slides-list');
            list.innerHTML = '';
            if(data) data.forEach(s => { list.innerHTML += `<div class="flex items-center gap-4 p-2 border dark:border-slate-700 rounded bg-white dark:bg-slate-800"><img src="${s.image_url}" class="w-16 h-10 object-cover rounded"><div class="flex-1"><p class="text-xs text-slate-500">Order: ${s.display_order}</p></div><button onclick="editSlide(${s.id})" class="text-blue-500 mr-2"><i class="fas fa-edit"></i></button><button onclick="deleteSlide(${s.id})" class="text-red-500"><i class="fas fa-trash"></i></button></div>`; });
            hideLoading();
        }
        
        window.editSlide = async function(id) {
            const { data } = await window.supabaseClient.from('slideshow_images').select('*').eq('id', id).single();
            if(data) {
                document.getElementById('slide-id').value = data.id;
                document.getElementById('slide-url').value = data.image_url;
                document.getElementById('slide-order').value = data.display_order;
                openModal('slide-modal');
            }
        }

        document.getElementById('slide-form').addEventListener('submit', async (e) => { 
            e.preventDefault(); showLoading();
            const id = document.getElementById('slide-id').value;
            const file = document.getElementById('slide-file').files[0];
            let url = document.getElementById('slide-url').value;
            if(file) { url = await uploadFile(file); }
            
            const payload = { image_url: url, display_order: document.getElementById('slide-order').value };
            
            if(id) await window.supabaseClient.from('slideshow_images').update(payload).eq('id', id);
            else await window.supabaseClient.from('slideshow_images').insert([payload]);
            
            closeModal('slide-modal'); loadSlides(); 
        });
        window.deleteSlide = async function(id) { await window.supabaseClient.from('slideshow_images').delete().eq('id', id); loadSlides(); }

        // --- OFFICERS (UPDATED CARD LAYOUT) ---
        async function loadOfficers() {
            showLoading();
            const { data } = await window.supabaseClient.from('officers').select('*').order('display_order');
            globalOfficers = data || [];
            renderOfficers(globalOfficers);
            hideLoading();
        }

        function renderOfficers(data) {
            const grid = document.getElementById('officers-grid');
            grid.innerHTML = '';
            if(data) data.forEach(o => {
                grid.innerHTML += `
                <div class="relative flex items-center gap-4 bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-100 dark:border-slate-700 shadow-sm group hover:shadow-md transition">
                    <div class="w-16 h-16 rounded-full overflow-hidden flex-shrink-0 border-2 border-blue-50 dark:border-slate-600">
                        <img src="${o.image_url || 'https://via.placeholder.com/150'}" class="w-full h-full object-cover">
                    </div>
                    <div class="flex-1 min-w-0">
                        <h4 class="font-bold text-slate-800 dark:text-white truncate">${o.name}</h4>
                        <p class="text-xs text-blue-600 dark:text-blue-400 font-bold uppercase mb-1">${o.position}</p>
                        
                        <div class="space-y-1">
                            ${o.email ? `<p class="text-[10px] text-slate-500 flex items-center gap-1 truncate"><i class="fas fa-envelope w-3"></i> ${o.email}</p>` : ''}
                            ${o.phone ? `<p class="text-[10px] text-slate-500 flex items-center gap-1 truncate"><i class="fas fa-phone w-3"></i> ${o.phone}</p>` : ''}
                            ${o.appointed_date ? `<p class="text-[10px] text-slate-400 flex items-center gap-1 truncate"><i class="fas fa-calendar-alt w-3"></i> Since: ${o.appointed_date}</p>` : ''}
                        </div>
                    </div>
                    
                    <div class="flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition absolute right-2 top-2">
                        <button onclick="editOfficer(${o.id})" class="w-8 h-8 rounded-full bg-blue-50 dark:bg-blue-900/30 text-blue-600 flex items-center justify-center hover:bg-blue-100 transition"><i class="fas fa-edit text-xs"></i></button>
                        <button onclick="deleteOfficer(${o.id})" class="w-8 h-8 rounded-full bg-red-50 dark:bg-red-900/30 text-red-600 flex items-center justify-center hover:bg-red-100 transition"><i class="fas fa-trash text-xs"></i></button>
                    </div>
                    
                    <div class="absolute bottom-2 right-2 flex gap-1">
                        ${o.show_email ? '<span class="w-2 h-2 rounded-full bg-green-500" title="Public Email"></span>' : '<span class="w-2 h-2 rounded-full bg-slate-300" title="Hidden Email"></span>'}
                        ${o.show_phone ? '<span class="w-2 h-2 rounded-full bg-green-500" title="Public Phone"></span>' : '<span class="w-2 h-2 rounded-full bg-slate-300" title="Hidden Phone"></span>'}
                    </div>
                </div>`;
            });
        }

        window.filterOfficers = function(query) {
            const filtered = globalOfficers.filter(o => o.name.toLowerCase().includes(query.toLowerCase()) || o.position.toLowerCase().includes(query.toLowerCase()));
            renderOfficers(filtered);
        }
        
        window.editOfficer = async function(id) {
            const { data } = await window.supabaseClient.from('officers').select('*').eq('id', id).single();
            if(data) {
                document.getElementById('off-id').value = data.id;
                document.getElementById('off-name').value = data.name;
                document.getElementById('off-pos').value = data.position;
                document.getElementById('off-img').value = data.image_url;
                document.getElementById('off-order').value = data.display_order;
                
                // Set new fields
                document.getElementById('off-dob').value = data.dob || '';
                document.getElementById('off-appointed').value = data.appointed_date || '';
                document.getElementById('off-email').value = data.email || '';
                document.getElementById('off-phone').value = data.phone || '';
                document.getElementById('off-show-email').checked = data.show_email || false;
                document.getElementById('off-show-phone').checked = data.show_phone || false;
                
                openModal('officer-modal');
            }
        }

        document.getElementById('officer-form').addEventListener('submit', async(e) => {
            e.preventDefault(); showLoading();
            const id = document.getElementById('off-id').value;
            const file = document.getElementById('off-file').files[0];
            let url = document.getElementById('off-img').value;
            if(file) { url = await uploadFile(file); }
            
            const payload = { 
                name: document.getElementById('off-name').value, 
                position: document.getElementById('off-pos').value, 
                image_url: url, 
                display_order: document.getElementById('off-order').value || 0,
                // New Fields
                dob: document.getElementById('off-dob').value || null,
                appointed_date: document.getElementById('off-appointed').value || null,
                email: document.getElementById('off-email').value || null,
                phone: document.getElementById('off-phone').value || null,
                show_email: document.getElementById('off-show-email').checked,
                show_phone: document.getElementById('off-show-phone').checked
            };
            
            if(id) await window.supabaseClient.from('officers').update(payload).eq('id', id);
            else await window.supabaseClient.from('officers').insert([payload]);
            
            closeModal('officer-modal'); loadOfficers();
        });
        window.deleteOfficer = async function(id) { if(confirm("Delete?")) { await window.supabaseClient.from('officers').delete().eq('id', id); loadOfficers(); } }

        // --- SPORTS ---
        async function loadSports() {
            showLoading();
            const { data } = await window.supabaseClient.from('sports_teams').select('*');
            globalSports = data || [];
            renderSports(globalSports);
            hideLoading();
        }

        function renderSports(data) {
            const grid = document.getElementById('sports-grid');
            grid.innerHTML = '';
            if(data) data.forEach(s => {
                grid.innerHTML += `<div class="bg-white dark:bg-slate-800 p-4 rounded-xl border dark:border-slate-700 relative group"><div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition"><button onclick="editSport(${s.id})" class="text-blue-500 bg-white p-1 rounded shadow mr-1"><i class="fas fa-edit"></i></button><button onclick="deleteSport(${s.id})" class="text-red-500 bg-white p-1 rounded shadow"><i class="fas fa-trash"></i></button></div><img src="${s.team_photo_url || 'https://via.placeholder.com/200'}" class="w-full h-32 object-cover rounded mb-2"><h4 class="font-bold dark:text-white">${s.sport_name}</h4><p class="text-xs text-slate-500">Capt: ${s.captain_name || 'N/A'}</p></div>`;
            });
        }

        window.filterSports = function(query) {
            const filtered = globalSports.filter(s => s.sport_name.toLowerCase().includes(query.toLowerCase()));
            renderSports(filtered);
        }
        
        window.editSport = async function(id) {
            const { data } = await window.supabaseClient.from('sports_teams').select('*').eq('id', id).single();
            if(data) {
                document.getElementById('sport-id').value = data.id;
                document.getElementById('sport-name').value = data.sport_name;
                document.getElementById('sport-captain').value = data.captain_name;
                document.getElementById('sport-img').value = data.team_photo_url;
                document.getElementById('sport-desc').value = data.description;
                openModal('sport-modal');
            }
        }

        document.getElementById('sport-form').addEventListener('submit', async(e) => {
            e.preventDefault(); showLoading();
            const id = document.getElementById('sport-id').value;
            const file = document.getElementById('sport-file').files[0];
            let url = document.getElementById('sport-img').value;
            if(file) { url = await uploadFile(file); }
            
            const payload = { sport_name: document.getElementById('sport-name').value, captain_name: document.getElementById('sport-captain').value, team_photo_url: url, description: document.getElementById('sport-desc').value };
            
            if(id) await window.supabaseClient.from('sports_teams').update(payload).eq('id', id);
            else await window.supabaseClient.from('sports_teams').insert([payload]);
            
            closeModal('sport-modal'); loadSports();
        });
        window.deleteSport = async function(id) { if(confirm("Delete?")) { await window.supabaseClient.from('sports_teams').delete().eq('id', id); loadSports(); } }

        // --- MESSAGES ---
        async function loadMessages() {
            showLoading();
            const { data } = await window.supabaseClient.from('messages').select('*').order('created_at', { ascending: false });
            globalMessages = data || [];
            renderMessages(globalMessages);
            hideLoading();
        }

        function renderMessages(data) {
            const tbody = document.getElementById('messages-list');
            tbody.innerHTML = '';
            if(data) data.forEach(m => {
                const date = new Date(m.created_at).toLocaleDateString();
                tbody.innerHTML += `
                <tr>
                    <td class="px-6 py-4"><div class="font-bold">${m.name}</div><div class="text-xs text-slate-500">${m.email}</div></td>
                    <td class="px-6 py-4 text-sm">${m.message}</td>
                    <td class="px-6 py-4 text-xs">${date}</td>
                    <td class="px-6 py-4 text-right">
                        <a href="mailto:${m.email}?subject=Reply to your message on Dream Makers" class="text-blue-500 mr-2 hover:scale-110 transition"><i class="fas fa-reply"></i></a>
                        <button onclick="deleteMessage(${m.id})" class="text-red-500 hover:scale-110 transition"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>`;
            });
        }

        window.filterMessages = function(query) {
            const filtered = globalMessages.filter(m => m.name.toLowerCase().includes(query.toLowerCase()) || m.email.toLowerCase().includes(query.toLowerCase()) || m.message.toLowerCase().includes(query.toLowerCase()));
            renderMessages(filtered);
        }

        window.deleteMessage = async function(id) { if(confirm("Delete?")) { await window.supabaseClient.from('messages').delete().eq('id', id); loadMessages(); } }

        // --- SETTINGS ---
        async function loadSettings() {
            const { data } = await window.supabaseClient.from('site_settings').select('*').limit(1).maybeSingle();
            if(data) {
                document.getElementById('set-address').value = data.address || '';
                document.getElementById('set-phone').value = data.contact_number || '';
                document.getElementById('set-email').value = data.email || '';
                document.getElementById('set-super-wa').value = data.super_admin_whatsapp || ''; 
                document.getElementById('set-admin-wa').value = data.admin_support_whatsapp || '';
                document.getElementById('set-fb').value = data.facebook_url || '';
                document.getElementById('set-yt').value = data.youtube_url || '';
                document.getElementById('set-ig').value = data.instagram_url || '';
                document.getElementById('set-wa').value = data.whatsapp_url || '';
            }
        }
        document.getElementById('settings-form').addEventListener('submit', async (e) => {
            e.preventDefault(); showLoading();
            const payload = { 
                address: document.getElementById('set-address').value, 
                contact_number: document.getElementById('set-phone').value, 
                email: document.getElementById('set-email').value, 
                super_admin_whatsapp: document.getElementById('set-super-wa').value, 
                admin_support_whatsapp: document.getElementById('set-admin-wa').value, 
                facebook_url: document.getElementById('set-fb').value, 
                youtube_url: document.getElementById('set-yt').value, 
                instagram_url: document.getElementById('set-ig').value, 
                whatsapp_url: document.getElementById('set-wa').value 
            };
            const { data } = await window.supabaseClient.from('site_settings').select('id').limit(1);
            if(data.length) await window.supabaseClient.from('site_settings').update(payload).eq('id', data[0].id); else await window.supabaseClient.from('site_settings').insert([payload]);
            alert("Saved!"); hideLoading();
        });

        // --- UTILS ---
        window.openModal = function(id) { 
            // If it's a "create" action (no prepopulation logic called before), clear fields
            if(document.getElementById(id).querySelector('form').checkValidity()) {
               // Optional: Reset form if opening fresh
            }
            document.getElementById(id).classList.remove('hidden'); 
        }
        
        window.closeModal = function(id) { 
            document.getElementById(id).classList.add('hidden'); 
            const form = document.getElementById(id).querySelector('form');
            if(form) {
                form.reset();
                const hiddenId = form.querySelector('input[type="hidden"]');
                if(hiddenId) hiddenId.value = '';
            }
        }
        
        // --- ADMINS ---
        async function loadAdmins() {
            showLoading();
            const { data } = await window.supabaseClient.from('admins').select('*').order('created_at', { ascending: false });
            globalAdmins = data || [];
            renderAdmins(globalAdmins);
            hideLoading();
        }

        function renderAdmins(data) {
            const tbody = document.getElementById('admins-table-body');
            tbody.innerHTML = '';
            if(data) data.forEach(a => {
                const isSelf = a.id === currentAdmin.id;
                const lastLogin = a.last_login ? new Date(a.last_login).toLocaleString() : 'Never';
                const actions = !isSelf ? 
                    `<button onclick="toggleAdminStatus(${a.id}, '${a.status}')" class="text-slate-500 mr-2 hover:scale-110" title="Deactivate"><i class="fas fa-power-off"></i></button>
                     <button onclick="editAdmin(${a.id})" class="text-blue-500 mr-2 hover:scale-110"><i class="fas fa-edit"></i></button>
                     <button onclick="deleteAdmin(${a.id})" class="text-red-500 hover:scale-110"><i class="fas fa-trash"></i></button>` : `<span class="text-xs text-slate-400">Current Session</span>`;
                
                tbody.innerHTML += `
                <tr>
                    <td class="px-6 py-4 font-medium">${a.name}</td>
                    <td class="px-6 py-4 text-xs">${a.email}</td>
                    <td class="px-6 py-4 text-xs font-bold uppercase">${a.role}</td>
                    <td class="px-6 py-4 text-xs text-slate-500">${lastLogin}</td>
                    <td class="px-6 py-4"><span class="px-2 py-1 rounded text-xs ${a.status === 'active' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">${a.status}</span></td>
                    <td class="px-6 py-4 text-right">${actions}</td>
                </tr>`;
            });
        }

        window.filterAdmins = function(query) {
            const filtered = globalAdmins.filter(a => a.name.toLowerCase().includes(query.toLowerCase()) || a.email.toLowerCase().includes(query.toLowerCase()));
            renderAdmins(filtered);
        }
        
        window.editAdmin = async function(id) {
            const { data } = await window.supabaseClient.from('admins').select('*').eq('id', id).single();
            if(data) {
                document.getElementById('admin-id').value = data.id;
                document.getElementById('admin-name-input').value = data.name;
                document.getElementById('admin-email-input').value = data.email;
                document.getElementById('admin-phone-input').value = data.contact_number;
                document.getElementById('admin-status-input').value = data.status;
                openModal('admin-modal');
            }
        }

        document.getElementById('admin-form').addEventListener('submit', async (e) => {
            e.preventDefault(); showLoading();
            const id = document.getElementById('admin-id').value;
            const password = document.getElementById('admin-password-input').value;
            
            const payload = {
                name: document.getElementById('admin-name-input').value,
                email: document.getElementById('admin-email-input').value,
                contact_number: document.getElementById('admin-phone-input').value,
                status: document.getElementById('admin-status-input').value,
                role: 'admin' 
            };
            if(password) payload.password = password;

            if(id) await window.supabaseClient.from('admins').update(payload).eq('id', id);
            else {
                if(!payload.password) payload.password = '123456';
                await window.supabaseClient.from('admins').insert([payload]);
            }
            closeModal('admin-modal'); loadAdmins();
        });
        window.deleteAdmin = async function(id) { if(confirm("Delete?")) { await window.supabaseClient.from('admins').delete().eq('id', id); loadAdmins(); } }
        window.toggleAdminStatus = async function(id, current) { 
            const newStatus = current === 'active' ? 'inactive' : 'active';
            await window.supabaseClient.from('admins').update({ status: newStatus }).eq('id', id); loadAdmins(); 
        }

    </script>
</body>
</html>